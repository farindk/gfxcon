
JPEGDIR = jpeg-6b
GLIBDIR = glib
PNGDIR  = libpng-1.0.3
ZLIBDIR = zlib-1.1.3

GLOBFLAGS = CPU=68000

FLAGS = NMINC STRMERGE UNSCHAR PARMS=REG IGNORE=104 NOCHKABORT \
        DEFINE=REGISTERED NODEBUG DEFINE=NDEBUG $(GLOBFLAGS)

OPTFLAGS = OPTGLOBAL OPTTIME OPTIMIZE


GFXCONOBJS = io.o main.o wb.o win.o cli.o formats.o gfxbuffer.o efx.o options.o \
 filbm.o fgif.o fpcx.o fgem.o ftiff.o fwgp.o frgb.o frgbn.o fimg.o fbmp.o fps.o \
 fjpeg.o ftga.o fcvp.o fpng.o

.c.o:
  sc $(FLAGS) $(OPTFLAGS) $*


LIBS = $(GLIBDIR)/glib.lib $(JPEGDIR)/libjpeg.lib $(PNGDIR)/libpng.lib $(ZLIBDIR)/z.lib

all: gfxcon.bin

gfxcon.bin: glib.FORCE libjpeg.FORCE gfxcon.MESSAGE $(GFXCONOBJS)
   @echo " ----- Linking GfxCon (finally) ----- "
   slink <WITH <
   FROM lib:catch.o $(GFXCONOBJS)
   TO gfxcon.bin
   LIBRARY $(LIBS) lib:scm.lib lib:sc.lib lib:amiga.lib
   <

gfxcon.MESSAGE:
   @echo " ----- Compiling GfxCon ----- "
   assign png: $(PNGDIR)

glib.FORCE:
   assign glib: $(GLIBDIR)
   execute < <
   echo " ----- Compiling GLib ----- "
   copy smakefile.glib $(GLIBDIR)
   cd $(GLIBDIR)
   smake -f smakefile.glib GLOBFLAGS=$(GLOBFLAGS) glib
   <

libjpeg.FORCE:
   assign jpeg: $(JPEGDIR)
   execute < <
   echo " ----- Compiling JPEGlib ----- "
   copy smakefile.jpeg $(JPEGDIR)
   cd $(JPEGDIR)
   smake -f smakefile.jpeg GLOBFLAGS=$(GLOBGLAGS) jpeglib
   <

